<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Recipe - Recipe Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/edit.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <a href="/recipes">Recipe Book</a>
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="Search for recipes...">
                    <button><i class="fas fa-search"></i></button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <a href="/recipes/<%= recipe.id %>" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Recipe
        </a>

        <div class="form-container">
            <h1 class="form-title">Edit Recipe</h1>
            
            <form action="/recipes/<%= recipe.id %>?_method=PATCH" method="POST">
                <div class="form-group">
                    <label for="title">Recipe Title</label>
                    <input type="text" id="title" name="title" class="form-control" value="<%= recipe.title %>" placeholder="e.g., Chocolate Chip Cookies" required>
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" class="form-control" placeholder="Describe your recipe..." required><%= recipe.description %></textarea>
                    <span class="form-hint">What makes this recipe special? Briefly describe the taste and origin.</span>
                </div>
                
                <div class="form-group">
                    <label for="ingredients">Ingredients</label>
                    <textarea id="ingredients" name="ingredients" class="form-control" placeholder="Enter each ingredient on a new line:" required> <% recipe.ingredients.forEach(ingredient => { %>
                        <%= ingredient %>
              <% }) %></textarea>
                    <span class="form-hint">Enter each ingredient on a separate line. You can use bullet points or dashes.</span>
                </div>
                
                <div class="form-group">
                    <label for="instructions">Instructions</label>
                    <textarea id="instructions" name="instructions" class="form-control" placeholder="Enter each step on a new line:" required><% recipe.instructions.forEach(instruction => {%>
              <%= instruction %>
              <% }); %></textarea>
                    <span class="form-hint">Enter each step on a separate line. Numbered steps work best.</span>
                </div>
                
                <div class="form-group">
                    <label for="cookingTime">Cooking Time</label>
                    <input type="text" id="cookingTime" name="cookingTime" class="form-control" value="<%= recipe.cookingTime %>" placeholder="e.g., 45 minutes" required>
                </div>
                
                <div class="form-group">
                    <label for="category">Category</label>
                    <div class="select-wrapper">
                        <select id="category" name="category" class="form-control" required>
                            <option value="">Select a category</option>
                            <option value="Main Course" <%= recipe.category === 'Main Course' ? 'selected' : '' %>>Main Course</option>
                            <option value="Dessert" <%= recipe.category === 'Dessert' ? 'selected' : '' %>>Dessert</option>
                            <option value="Appetizer" <%= recipe.category === 'Appetizer' ? 'selected' : '' %>>Appetizer</option>
                            <option value="Salad" <%= recipe.category === 'Salad' ? 'selected' : '' %>>Salad</option>
                            <option value="Soup" <%= recipe.category === 'Soup' ? 'selected' : '' %>>Soup</option>
                            <option value="Breakfast" <%= recipe.category === 'Breakfast' ? 'selected' : '' %>>Breakfast</option>
                            <option value="Snack" <%= recipe.category === 'Snack' ? 'selected' : '' %>>Snack</option>
                            <option value="Beverage" <%= recipe.category === 'Beverage' ? 'selected' : '' %>>Beverage</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="image">Recipe Image</label>
                    <% if (recipe.image) { %>
                        <div class="current-image">Current Image:</div>
                        <img id="image-preview" src="<%= recipe.image %>" alt="Current recipe image">
                    <% } %>
                    <div class="image-upload" id="image-upload-area">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div class="image-upload-text">Drag & drop a new image here or click to browse</div>
                        <div class="image-upload-btn">Select Image</div>
                        <input type="file" id="image" name="image" accept="image/*" style="display: none;">
                    </div>
                    <span class="form-hint">Upload a new image to replace the current one (optional).</span>
                </div>
                
                <div class="form-actions">
                    <a href="/recipes/<%= recipe.id %>" class="btn btn-cancel">Cancel</a>
                    <button type="submit" class="btn btn-submit">
                        <i class="fas fa-save"></i> Update Recipe
                    </button>
                </div>
            </form>
            
            <form action="/recipes/<%= recipe.id %>?_method=DELETE" method="POST" style="margin-top: 20px;">
                <button type="submit" class="btn btn-delete" onclick="return confirm('Are you sure you want to delete this recipe? This action cannot be undone.')">
                    <i class="fas fa-trash"></i> Delete Recipe
                </button>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 Recipe Book. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Image upload preview functionality
        const imageUploadArea = document.getElementById('image-upload-area');
        const imageInput = document.getElementById('image');
        const imagePreview = document.getElementById('image-preview');
        
        imageUploadArea.addEventListener('click', () => {
            imageInput.click();
        });
        
        imageInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    // If there's already a preview, update it
                    if (imagePreview) {
                        imagePreview.src = e.target.result;
                    } else {
                        // Create a new preview image
                        const newPreview = document.createElement('img');
                        newPreview.id = 'image-preview';
                        newPreview.src = e.target.result;
                        newPreview.alt = 'Image preview';
                        newPreview.style.maxWidth = '100%';
                        newPreview.style.marginTop = '20px';
                        newPreview.style.borderRadius = '8px';
                        newPreview.style.overflow = 'hidden';
                        newPreview.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.1)';
                        
                        // Insert after the upload area
                        imageUploadArea.parentNode.insertBefore(newPreview, imageUploadArea.nextSibling);
                    }
                }
                
                reader.readAsDataURL(this.files[0]);
            }
        });
        
        // Drag and drop functionality
        imageUploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.style.borderColor = '#e52e71';
            this.style.backgroundColor = '#fff5f7';
        });
        
        imageUploadArea.addEventListener('dragleave', function() {
            this.style.borderColor = '#e0e0e0';
            this.style.backgroundColor = 'white';
        });
        
        imageUploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.style.borderColor = '#e0e0e0';
            this.style.backgroundColor = 'white';
            
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                imageInput.files = e.dataTransfer.files;
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    if (imagePreview) {
                        imagePreview.src = e.target.result;
                    }
                }
                
                reader.readAsDataURL(e.dataTransfer.files[0]);
            }
        });
    </script>
</body>
</html>